

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BIM for Off-Chip OAD &mdash; SimpleLink™ CC26x2 TI Thread User&#39;s Guide 1.02.00.00 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="SimpleLink™ CC26x2 TI Thread User&#39;s Guide 1.02.00.00 documentation" href="../index.html"/> 
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug oad-ble3 bim-offchip";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script> 

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8">     



  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../thread/index-cc26x2.html" class="icon icon-home"> SimpleLink™ CC26x2 TI Thread User's Guide
          

          
          </a>

          
            
            
              <div class="version">
                1.02.00.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../thread/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc26x2/index-thread.html">CC26x2 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/ot-sw-dev-env.html">TI-OpenThread Stack Software Development Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/ot-stack-overview.html">TI-OpenThread Stack Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/running-example-apps-cc26x2.html">Example Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-br/index.html">Linux Border Router Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/creating-custom-apps.html">Creating Custom Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/custom-hardware.html">Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/packet-sniffer.html">Packet Sniffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging/thread-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-oad/index.html">Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/migration.html">Migration Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../thread/index-cc26x2.html">SimpleLink™ CC26x2 TI Thread User's Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../thread/index-cc26x2.html">Docs</a> &raquo;</li>
      
    <li>BIM for Off-Chip OAD</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bim-for-off-chip-oad">
<span id="sec-oad-bim-offchip"></span><h1>BIM for Off-Chip OAD<a class="headerlink" href="#bim-for-off-chip-oad" title="Permalink to this headline">¶</a></h1>
<p>At steady state, the normal case is that a valid image exists in internal flash
and no image in the external flash has been marked as needing to be copied. In
this case, BIM will validate that the image on internal flash and execute it
by loading the stack pointer and jumping to the image’s reset vector location.
BIM determines the location of the reset vector and stack pointer of the image
through the OAD image header attached to it.</p>
<div class="figure align-center" id="id2">
<span id="fig-bim-offchip-flowchart"></span><p class="plantuml">
<img src="../_images/plantuml-54469c939ce8355f4461e9a7dbab771f4f6d7cc8.png" alt="&#64;startuml
(*)  --&gt; &quot;Device Boot&quot;
If &quot;Unchecked images on external flash?&quot; then
    --&gt; [Yes] &quot;Read header from external flash&quot;
    If &quot;Header valid?&quot; then
        --&gt; [Yes] &quot;Copy image to internal flash&quot;
        If &quot;Copy and CRC succeeded?&quot; then
            --&gt; [Yes] &quot;Jump to image&quot;
            --&gt;(*)
        else
            --&gt; [No] &quot;Revert to factory image&quot;
        Endif
    else
        --&gt; [No] &quot;Check image on internal flash&quot;
    Endif
else
    --&gt; [No] &quot;Check image on internal flash&quot;
    If &quot;Image valid?&quot; then
        -left-&gt; [Yes] &quot;Jump to image&quot;
    else
        --&gt; [No] &quot;Revert to factory image&quot;
        If &quot;Revert succeeded?&quot; then
            --&gt; [Yes] &quot;Jump to image&quot;
        else
            --&gt; [No] &quot;Spin lock&quot;
            --&gt; &quot;Spin lock&quot;
        Endif
    Endif
Endif
&#64;enduml

Functional Overview of Off-chip BIM" />
</p>
<p class="caption"><span class="caption-text">Sequence diagram for BIM image selection process</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The image above is illustrated in words below. In order to determine which
image is best to run, BIM takes the following measures:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">At startup, BIM looks for a valid image header in external flash by
reading the first 8 bytes to find the valid External Flash Image
Identification value.</p>
</li>
<li><p class="first">After a valid header is found, it reads the entire header from ext flash
and verifies the compatibility of BIM and image header versions. Then it
checks if the ‘Image copy status’ is set to be copied to the on-chip
flash(0xFE) and has a valid CRC (CRC status=0xFE).</p>
<blockquote>
<div><ul class="simple">
<li>If a compatible header is found, secure versions of the BIM will
check the signature of the image using ECDSA verification algorithm.</li>
<li>If it finds status ‘CRC not calculated’(CRC Status = 0xFF), it
calculates the CRC of the external flash contents and updates the CRC
status byte in the external flash.</li>
<li>On finding the invalid CRC it moves on to read the next image’s
header.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">If a valid image is found, BIM copies the image to on-chip flash, as per
the image copy procedure.</p>
<blockquote>
<div><ul class="simple">
<li>After the copy, the CRC is re-checked on internal flash to ensure the
copy succeeded.</li>
<li>If the copy failed the status byte is updated and the BIM will
continue searching external flash.</li>
<li>If the copy succeeded, then the BIM will verify the image again
and if successful jump directly to the application image, and the
search process ends.</li>
</ul>
</div></blockquote>
</li>
</ol>
<ol class="arabic simple" start="5">
<li>If BIM reaches the end of the image header region in external flash
without finding a valid image, then it will try to find an on-chip image
and execute it.</li>
<li>If BIM fails to find a valid image internal flash, it will attempt to
revert the factory image if there is one present.</li>
<li>BIM will put the device to low power mode if it fails to find a valid
application image.</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An image is considered bad/invalid if it’s calculated CRC32 does not match
the image’s CRC bytes embedded in the image header.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The execution flow described by the text and diagrams above is assuming
security is on. If using an unsecured BIM configuration, the process is the
same with the exception that there is no check for security.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">2016-2018, Texas Instruments</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.02.00.00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });

        $('body').on("mousewheel", function () {
            // Remove default behavior
            event.preventDefault();
            // Scroll without smoothing
            var wheelDelta = event.wheelDelta;
            var currentScrollPosition = window.pageYOffset;
            window.scrollTo(0, currentScrollPosition - wheelDelta);
        });
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>