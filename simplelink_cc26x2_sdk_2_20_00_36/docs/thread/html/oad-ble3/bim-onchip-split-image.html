

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BIM for On-Chip OAD (Split Image) &mdash; SimpleLink™ CC26x2 TI Thread User&#39;s Guide 1.02.00.00 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="SimpleLink™ CC26x2 TI Thread User&#39;s Guide 1.02.00.00 documentation" href="../index.html"/> 
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug oad-ble3 bim-onchip-split-image";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script> 

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8">     



  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../thread/index-cc26x2.html" class="icon icon-home"> SimpleLink™ CC26x2 TI Thread User's Guide
          

          
          </a>

          
            
            
              <div class="version">
                1.02.00.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../thread/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc26x2/index-thread.html">CC26x2 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/ot-sw-dev-env.html">TI-OpenThread Stack Software Development Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/ot-stack-overview.html">TI-OpenThread Stack Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/running-example-apps-cc26x2.html">Example Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-br/index.html">Linux Border Router Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/creating-custom-apps.html">Creating Custom Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/custom-hardware.html">Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/packet-sniffer.html">Packet Sniffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging/thread-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../energy-trace/energy-trace.html">EnergyTrace User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread-oad/index.html">Over-the-Air Download (OAD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thread/migration.html">Migration Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../thread/index-cc26x2.html">SimpleLink™ CC26x2 TI Thread User's Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../thread/index-cc26x2.html">Docs</a> &raquo;</li>
      
    <li>BIM for On-Chip OAD (Split Image)</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bim-for-on-chip-oad-split-image">
<span id="sec-oad-bim-onchip"></span><h1>BIM for On-Chip OAD (Split Image)<a class="headerlink" href="#bim-for-on-chip-oad-split-image" title="Permalink to this headline">¶</a></h1>
<p>This section describes the behavior of the BIM for on-chip OAD where the
the split image approach is used. This approach requires the application and
protocol stack to be separately executable images. As with off-chip OAD, it is
BIM’s responsibility to locate which image should be run. In an on-chip OAD
system there are only two image types that can be executed safely:</p>
<blockquote>
<div><ul class="simple">
<li>Persistent application (0x00): Permanently resident application that
implements OAD profile</li>
<li>User application (0x01): OAD upgradeable application that implements OAD
reset service and user functionality</li>
</ul>
</div></blockquote>
<p>For more information about OAD image types, refer to the
<a class="reference internal" href="../oad/image-header.html#sec-oad-image-header"><span class="std std-ref">OAD Image Header</span></a> section of this chapter. The roles and
responsibilities of each application in an on-chip system is defined in the
<a class="reference internal" href="../thread-oad/oad-process.html#oad-process"><span class="std std-ref">OAD Process</span></a> section.</p>
<p>In summary, the applications are responsible for storing a candidate image in
internal flash, performing all OAD procedures and protocols, setting the BIM
variable, and resetting the device when appropriate. The BIM variable is a
shared RAM variable that allows the application to indicate which image should
be selected by the BIM before resetting. This is described in
<a class="reference internal" href="#sect-ram-argument"><span class="std std-ref">Application Execution switching using RAM</span></a>.</p>
<p>Based on the BIM var and the fields in the image header, the BIM will decide
which image is most fit to run. The following will
describe the process by which the BIM selects an image.</p>
<div class="figure align-center" id="id2">
<span id="fig-bim-onchip-split-image-flowchart"></span><p class="plantuml">
<img src="../_images/plantuml-d00bf77a92e374071eb0f95a20b41e50ff1b56c1.png" alt="&#64;startuml
(*)  --&gt; &quot;Device Boot&quot;
If &quot;BIM Var is set?&quot; then
    --&gt; [Yes] &quot;Set image type, flash page variable based on BIM var&quot;
    --&gt; &quot;Read OAD Image ID field from current flash page&quot;
    If &quot;Image ID found?&quot; then
        --&gt; [Yes] &quot;Read remaining image header&quot;
        If &quot;Image header compatible/valid?&quot; then
            --&gt; [Yes] &quot;Perform additional image validation/copy&quot;
            If &quot;Image is ready to run&quot; then
                --&gt; [Yes] &quot;Jump to Image&quot;
                --&gt;(*)
            else
                --&gt; [No] &quot;Change image type, reset flash page&quot;
            Endif
        else
            --&gt; [No] &quot;Increase flash page number&quot;
        Endif
    else
        --&gt; [No] If &quot;Reached the end of flash?&quot; then
            If &quot;Max number of search iterations?&quot;
                --&gt; [Yes] &quot;Low power mode&quot;
                --&gt; &quot;Low power mode&quot;
            else
                --&gt; [No] &quot;Change image type, reset flash page&quot;
                --&gt; &quot;Read OAD Image ID field from current flash page&quot;
            Endif
        else
            --&gt; [No] &quot;Increase flash page number&quot;
            --&gt; &quot;Read OAD Image ID field from current flash page&quot;
        Endif
    Endif

else
    --&gt; [No] &quot;Set image type to user application, flash page to 0&quot;
    --&gt; &quot;Read OAD Image ID field from current flash page&quot;
Endif
&#64;enduml

Functional Overview of On-chip BIM (split image)" />
</p>
<p class="caption"><span class="caption-text">Sequence diagram for on-chip BIM image selection process</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The image above is described in words below. In order to determine which
image is best to run, BIM takes the following measures:</p>
<blockquote>
<div><ol class="arabic">
<li><dl class="first docutils">
<dt>At startup, the BIM checks the BIM variable and sets active flash page or</dt>
<dd><p class="first last">image type based on <a class="reference internal" href="#sect-ram-argument"><span class="std std-ref">Application Execution switching using RAM</span></a>. If BIM variable is unset
it will default to flash page of 0 and image type of user application.</p>
</dd>
</dl>
</li>
<li><p class="first">BIM checks to make sure the max search iterations have not been exceeded</p>
</li>
<li><p class="first">BIM looks for a valid image header in internal flash by reading the first
8 bytes to find the valid image Identification value.</p>
<blockquote>
<div><ul class="simple">
<li>If a valid image header is found, BIM will read the entire image
header</li>
<li>If a header is not found, increment the flash page and search again
(jump to step #2)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Checks that the header and BIM version are compatible with the current
BIM</p>
<blockquote>
<div><ul class="simple">
<li>Also checks that the if the image needs copy, it must be a stack image.</li>
<li>If this check fails, increase the flash page number and search again
(jump to step #2). If user application, change image type to
persistent application before searching again</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">If a CRC has not been calculated on the image, calculate one and update
CRC status field.</p>
<blockquote>
<div><ul class="simple">
<li>If pending copy (stack image), do not update the CRC field yet, this
will be done after copy</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Check for security. (if not persistent application)</p>
<blockquote>
<div><ul class="simple">
<li>Ensure image is from a trusted peer by running ECDSA sign/verify
algorithm on the image.</li>
<li>If security check fails, increment the flash page and search again
(jump to step #2)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Check if the image needs to be copied (stack image)</p>
<blockquote>
<div><ul class="simple">
<li>Copy image, calculate CRC to ensure copy succeeded. Update copy status
and CRC status fields accordingly.</li>
<li>If succeeded, set image type to persistent application and set flash
page number to 0.</li>
<li>If failed, continue searching.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Continue this process until an image is found or the max iterations is
performed.</p>
<blockquote>
<div><ul class="simple">
<li>If a valid image is found, jump to it</li>
<li>If no valid image is found and the max iterations have been performed,
go to low power mode.</li>
</ul>
</div></blockquote>
</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The execution flow described by the text and diagrams above is assuming
security is on. If using an unsecured BIM configuration, the process is the
same with the exception that there is no check for security.</p>
</div>
<div class="section" id="application-execution-switching-using-ram">
<span id="sect-ram-argument"></span><h2>Application Execution switching using RAM<a class="headerlink" href="#application-execution-switching-using-ram" title="Permalink to this headline">¶</a></h2>
<p>On devices which have RAM retention capability between resets, execution
switching between application can be done using RAM variables.
For example, on the CC26x2, execution switching between User and Persistent
Applications will be done by writing to a RAM variable stored at
a known RAM location. This location will be used explicitly for application
switching only. The value will be retained between resets.</p>
<p>The RAM variable called ‘BIM Argument’ is two bytes long with values as defined
in <a class="reference internal" href="#tbl-bim-argument"><span class="std std-ref">Description of the BIM Argument variable.</span></a>. The byte 0 value defines the meaning of
the byte 1 content. In SimpleLink CC26x2 SDK, there are two valid values for byte 0: ‘0’ and ‘1’.
Values 2-255 are reserved for future use. If BIM encounters a byte0 value
greater than 1, it will consider if invalid, will try to find the
default application starting from flash page ‘0’, by reading image header.</p>
<span id="tbl-bim-argument"></span><table border="1" class="docutils" id="id3">
<caption><span class="caption-text">Description of the BIM Argument variable.</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="16%" />
<col width="22%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Byte 0 Value</th>
<th class="head">Byte 1 Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="9">0</td>
<td rowspan="9">0</td>
<td rowspan="9"><p class="first">Default value after hard reset.</p>
<p>The ‘argument variable’ contents are invalid, BIM</p>
<p>needs to find a valid on-chip user application and</p>
<p>execute it.</p>
<p>If BIM cannot find the valid User Application,</p>
<p>then it will try to find a valid Persistent App</p>
<p>and execute.</p>
<p>If it is unable to find either application it will</p>
<p class="last">put the device to low power sleep mode.</p>
</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"></tr>
<tr class="row-odd"></tr>
<tr class="row-even"></tr>
<tr class="row-odd"></tr>
<tr class="row-even"></tr>
<tr class="row-odd"></tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="4">0</td>
<td rowspan="4">Flash page number</td>
<td rowspan="4"><p class="first">Byte 1 contains the application start address BIM</p>
<p>needs to jump to on resuming execution after a soft</p>
<p>reset. The address will be in terms of flash page</p>
<p class="last">number.</p>
</td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"></tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td>1</td>
<td>Image Type</td>
<td>Version required to support image format</td>
</tr>
<tr class="row-even"><td>2-255</td>
<td>N/A</td>
<td>Version of Image Header contained in image</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">2016-2018, Texas Instruments</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.02.00.00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });

        $('body').on("mousewheel", function () {
            // Remove default behavior
            event.preventDefault();
            // Scroll without smoothing
            var wheelDelta = event.wheelDelta;
            var currentScrollPosition = window.pageYOffset;
            window.scrollTo(0, currentScrollPosition - wheelDelta);
        });
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>